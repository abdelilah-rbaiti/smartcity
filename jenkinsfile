pipeline {
  agent any
  stages { 
    stage('Checkout') {
      steps {
        checkout scm
        sh 'echo "Checkout passed successfully"'
      }
    }
 stage('Detect Secrets with GitLeaks') {
            steps {
                script {
 
                    // Disable Go modules
                    sh 'export GO111MODULE=off'

                    // Initialize Go module with a placeholder path
                    sh 'go mod init example.com/smartcity'

                    // Run GitLeaks within the project directory
                    dir("${WORKSPACE}") {
                        sh 'go build -o /usr/local/bin/gitleaks ./gitleaks && /usr/local/bin/gitleaks'
                }
            }
        }
  }
}
